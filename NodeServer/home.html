<!DOCTYPE html>

<head>
  <title>Weather Dashboard</title>
  <script type="module" src="./weather_bundle.js" defer></script>
  <script src="//unpkg.com/alpinejs" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div class="flex flex-col item-center h-screen mx-20">
    <div class="flex-none">
      <h1 class="text-2xl font-semibold py-4 px-2">
        Weather with Embedded Proto
      </h1>
      <button class="bg-slate-200 p-2 rounded" x-data @click="$store.weather.get_data_from_server()">Get weather data</button>
    </div>
    
    <ul x-init="$watch('$store.weather.data', data => console.log(data))">
      <template x-for="data in $store.weather.data" >
          <li x-text="data.temperature"></li>
      </template>
    </ul>

    <div class="flex-grow">
      <div class="flex flex-wrap">
        <div class="flex-none w-96">

        </div>
        <div class="flex-none w-96">

        </div>
        <div class="flex-none w-96">

        </div>
      </div>
    </div>

    <div class="h-48">
      <div class="box border rounded flex flex-col shadow">
        <div class="flex-none bg-slate-200 px-3 py-2 border-b">
          <h3 class="text-sm font-medium">Log Window</h3>
        </div>
        <div class="flex-grow bg-slate-100 p-2 h-32">
          <div class="bg-white rounded p-2 h-full overflow-y-scroll shadow">
            <template x-init="console.log('Log window template: '); console.log($store.logging.logs)" x-for="log in $store.logging.logs">
              <p x-text="log"></p>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
  
</body>

<script defer>

document.addEventListener('alpine:init', () => {
  console.log("alpine:init")
  Alpine.store('logging', {    
    logs: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],

    add(log_msg) {
      this.logs.push(log_msg);
    }
  }),
  Alpine.store('weather', {
    data: new Array(),

    async get_data_from_server() {
      let server_url = window.location.href + "api/data";
      let response = await fetch(server_url);
      let msg = weather.weather.Data.decode(new Uint8Array(await response.arrayBuffer()));
      console.log(await msg);
      this.data.push(await msg);
    }

  })
})
</script>

</html>
